<div id="mapContainer" style="position: relative; display: inline-block;">
  <img
    id="map"
    src="images/map_azimutal.jpeg"
    alt="Carte azimutale √©quidistante"
  />
</div>
<div id="status">Chargement‚Ä¶</div>

<script>
  async function drawSunMoonAzimuth(lat, lon) {
    const res = await fetch(
      `https://syncrolink-server.onrender.com/sunmoon?lat=${lat}&lon=${lon}`
    );
    if (!res.ok) {
      document.getElementById("status").textContent =
        "‚ùå Erreur serveur " + res.status;
      return;
    }
    const { sunAzimuth, moonAzimuth } = await res.json();
    document.getElementById("status").innerHTML =
      `‚òÄÔ∏è Azimut Soleil: ${sunAzimuth.toFixed(1)}¬∞<br>` +
      `üåô Azimut Lune: ${moonAzimuth.toFixed(1)}¬∞`;

    const img = document.getElementById("map");
    // Attend le chargement de l‚Äôimage pour r√©cup√©rer ses dimensions
    if (!img.complete) await new Promise((r) => (img.onload = r));

    const w = img.naturalWidth, h = img.naturalHeight;
    const cx = w / 2, cy = h / 2;      // centre = Nord
    const R = h / 2;                   // rayon = distance centre ‚Üí bord

    const container = document.getElementById("mapContainer");
    // Supprime les anciennes ic√¥nes
    container.querySelectorAll(".marker").forEach((e) => e.remove());

    // Fonction pour placer une ic√¥ne selon l‚Äôazimut
    function placeMarker(az, iconSrc) {
      const Œ∏ = (az * Math.PI) / 180;      // conversion en radians
      const r = (az / 180) * R;            // 0¬∞‚Üí0px ; 180¬∞‚ÜíR pixels
      const x = cx + r * Math.sin(Œ∏);
      const y = cy + r * Math.cos(Œ∏);

      const el = document.createElement("img");
      el.src = iconSrc;
      el.className = "marker";
      Object.assign(el.style, {
        position: "absolute",
        width: "32px",
        left:  `${x - 16}px`,
        top:   `${y - 16}px`,
      });
      container.appendChild(el);
    }

    // Place le soleil et la lune
    placeMarker(sunAzimuth,  "images/sun_icon.png");
    placeMarker(moonAzimuth, "images/moon_icon.png");
  }

  // Ex. pour Paris (√† adapter ou rendre dynamique)
  drawSunMoonAzimuth(48.8566, 2.3522);
</script>
