<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BUHS | BigTree Terminal V1.8</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        :root { 
            --v3-bg: #0a0a0a; --v3-blue: #3b82f6; --v3-border: #27272a;
            --v1-neon: #00ff41; --v1-bg: #121212; --v1-border: #333;
        }
        body { margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; background: #000; color: #fff; font-family: sans-serif; overflow: hidden; }
        #mode-selector { position: absolute; top: 20px; display: flex; gap: 10px; z-index: 1001; }
        .sw-btn { background: #1a1a1a; border: 1px solid #333; color: #666; padding: 8px 16px; border-radius: 20px; font-size: 0.7rem; cursor: pointer; transition: 0.3s; }
        .sw-btn.active { border-color: #fff; color: #fff; background: #222; }
        #terminal-master { width: 360px; min-height: 720px; position: relative; transition: 0.5s; border-radius: 40px; padding: 80px 25px 25px 25px; display: flex; flex-direction: column; box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
        .v3-theme { background: var(--v3-bg); border: 1px solid var(--v3-border); }
        .v1-theme { background: var(--v1-bg); border: 2px solid var(--v1-border); font-family: 'Courier New', monospace; color: var(--v1-neon); }
        #jumper-container { display: none; position: absolute; inset: 0; width: 100%; height: 100%; background: #000; z-index: 1000; border-radius: 40px; overflow: hidden; }
        #jumper-iframe { width: 100%; height: 100%; border: none; }
        #close-jumper { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); background: #1a1a1a; border: 1px solid #444; color: #fff; padding: 8px 20px; border-radius: 20px; cursor: pointer; z-index: 1001; font-size: 0.7rem; }
        .data-box { background: rgba(255,255,255,0.03); border: 1px solid #333; padding: 15px; margin-bottom: 12px; border-radius: 16px; display: flex; align-items: center; justify-content: space-between; }
        .hidden { display: none !important; }
        .unit { text-align: center; width: 85px; }
        .large-icon { width: 42px; height: 42px; object-fit: contain; margin-bottom: 4px; }
        .label-sub { font-size: 0.55rem; color: #666; font-weight: bold; display: block; }
        .btn-main { width: 100%; padding: 18px; border: none; border-radius: 18px; font-weight: bold; font-size: 1rem; cursor: pointer; transition: 0.3s; margin-top: 15px; }
        .v3-theme .btn-main { background: #fff; color: #000; }
        .v1-theme .btn-main { background: var(--v1-neon); color: #000; border-radius: 0; }
        input[type=number] { background: transparent; border: 1px solid #222; color: #fff; padding: 15px; border-radius: 12px; width: 100%; box-sizing: border-box; text-align: center; margin-top: 10px; outline: none; }
        .btn-donate { background: transparent; border: 1px solid #222; color: #444; padding: 8px; border-radius: 12px; font-size: 0.6rem; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body class="v3-mode">

    <div id="mode-selector">
        <button id="btn-v3" class="sw-btn active" onclick="setMode('v3')">UTILITY_UI</button>
        <button id="btn-v1" class="sw-btn" onclick="setMode('v1')">NATIVE_OS</button>
    </div>

    <div id="terminal-master" class="v3-theme">
        
        <div id="jumper-container">
            <button id="close-jumper" onclick="closeJumper()">CLOSE [X]</button>
            <iframe id="jumper-iframe" src="" allow="clipboard-read; clipboard-write; usb; bluetooth; eth-keycard"></iframe>
        </div>

        <div id="section-v3">
            <div style="text-align: center; margin-bottom: 25px;">
                <h1 style="font-size: 0.8rem; letter-spacing: 1px; color: #888;">BIGTREE_GATEWAY</h1>
                <div id="btg-price" style="font-size: 0.7rem; color: var(--v3-blue);">PRICE_FEED: $--.------</div>
            </div>

            <div class="data-box">
                <div class="unit">
                    <img src="https://cryptologos.cc/logos/ethereum-eth-logo.png" class="large-icon">
                    <span class="label-sub">TOKEN: ETH</span>
                </div>
                <div style="font-weight: bold;">BASE</div>
                <div class="unit">
                    <img src="https://basescan.org/images/svg/brands/base.svg" class="large-icon">
                    <span class="label-sub">NETWORK</span>
                </div>
            </div>

            <div style="text-align: center; color: var(--v3-blue); margin: -5px 0;">↓</div>

            <div class="data-box">
                <div class="unit">
                    <img src="https://paragraph.xyz/favicon.ico" class="large-icon" style="border-radius: 8px;">
                    <span class="label-sub">TOKEN: $BTG</span>
                </div>
                <div style="font-weight: bold;">BASE</div>
                <div class="unit">
                    <img src="https://basescan.org/images/svg/brands/base.svg" class="large-icon">
                    <span class="label-sub">NETWORK</span>
                </div>
            </div>

            <input type="number" id="ethIn" placeholder="ENTER AMOUNT">
            <button class="btn-main" onclick="executeAction()" id="main-btn-v3">CONNECT_WALLET</button>
        </div>

        <div id="section-v1" class="hidden">
            <div style="font-size: 0.7rem; border-bottom: 1px solid var(--v1-neon); padding-bottom: 10px; margin-bottom: 20px;">
                > BIGTREE_DEEPTECH_OS<br>> VAULT: 0x4907...2599
            </div>
            <div class="data-box" style="font-size: 0.6rem; flex-direction: column; align-items: flex-start;">
                <div>> STATUS: <span style="color:#fff">SKIN_IN_THE_GAME</span> | <span style="color:var(--v1-neon)">48H_LOCK</span></div>
                <div style="margin-top:5px;">> AUTH: <span id="auth-status">PENDING</span></div>
            </div>
            <div class="data-box" style="font-size: 0.6rem; justify-content: center;">
                <a href="https://basescan.org/address/0x49073Eeae1DE741868838341695A4EAd3e642599" target="_blank" style="color:var(--v1-neon); text-decoration: none;">
                    VIEW_ON_EXPLORER_SAFE ↗
                </a>
            </div>
            <button class="btn-main" id="main-btn-v1" onclick="window.open('https://paragraph.xyz/@bigtree.buhs', '_blank')">SYNC_CORE</button>
        </div>

        <div style="text-align: center; margin-top: auto;">
            <p style="font-size: 0.5rem; color: #333; font-style: italic;">"This application runs thanks to your participation."</p>
            <button class="btn-donate" onclick="window.open('https://paragraph.xyz/@bigtree.buhs/support', '_blank')">DONATE</button>
        </div>
    </div>

<script>
    const BTG_ADDR = "0x14e732bbba1cd07685d2081869ca5062ac32463a";
    let userAddress = null;

    function setMode(mode) {
        document.getElementById('terminal-master').className = mode + '-theme';
        document.getElementById('section-v3').classList.toggle('hidden', mode !== 'v3');
        document.getElementById('section-v1').classList.toggle('hidden', mode !== 'v1');
        document.getElementById('btn-v3').classList.toggle('active', mode === 'v3');
        document.getElementById('btn-v1').classList.toggle('active', mode === 'v1');
    }

    async function executeAction() {
        if (!userAddress && window.ethereum) {
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            userAddress = accounts[0];
            document.getElementById('main-btn-v3').innerText = "EXECUTE_SWAP";
            
            const provider = new ethers.BrowserProvider(window.ethereum);
            const abi = ["function balanceOf(address) view returns (uint256)"];
            const contract = new ethers.Contract(BTG_ADDR, abi, provider);
            const bal = await contract.balanceOf(userAddress);
            document.getElementById('auth-status').innerText = (parseFloat(ethers.formatEther(bal)) > 0) ? "VERIFIED_HOLDER" : "GUEST";
        } else if (userAddress) {
            // C'EST ICI QUE LA MAGIE OPÈRE : L'URL EST CORRIGÉE POUR LE SWAP
            const url = `https://jumper.exchange/embed?fromChain=8453&toChain=8453&toToken=${BTG_ADDR}&theme=dark`;
            document.getElementById('jumper-iframe').src = url;
            document.getElementById('jumper-container').style.display = 'block';
        }
    }

    function closeJumper() {
        document.getElementById('jumper-container').style.display = 'none';
        document.getElementById('jumper-iframe').src = '';
    }

    async function fetchPrice() {
        try {
            const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${BTG_ADDR}`);
            const data = await res.json();
            if(data.pairs) {
                document.getElementById('btg-price').innerText = `PRICE_FEED: $${parseFloat(data.pairs[0].priceUsd).toFixed(6)}`;
            }
        } catch(e) {}
    }
    setInterval(fetchPrice, 10000); fetchPrice();
</script>
</body>
</html>
