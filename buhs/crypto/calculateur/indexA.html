
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>BUHS Calculateur (BTC - Δ réel)</title>
  <style>
    body { background: #1e1e1e; color: white; font-family: sans-serif; padding: 2rem; text-align: center; }
    input { padding: 0.5rem; font-size: 1rem; width: 150px; margin-top: 1rem; }
    .output { margin-top: 1.2rem; font-size: 1.1rem; }
    .label { font-weight: bold; margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>BUHS Calculateur – BTC (Δ réel)</h1>

  <label class="label">Montant du trade en BTC :</label>
  <input type="number" id="btcInput" value="0.1" step="0.01" />

  <div class="output" id="priceOpen">Prix d'ouverture : ...</div>
  <div class="output" id="priceNow">Prix actuel : ...</div>
  <div class="output" id="deltaNow">Δ (écart réel) : ...</div>
  <div class="output" id="wNow">Valeur du trade (W) : ...</div>
  <div class="output" id="phiNow">Φ : 1.0000 (fixé)</div>
  <div class="output" id="psiNow">Ψ : 0.0000</div>
  <div class="output" id="yResult">Y (Δ·W·Ψ) : 0 USDT</div>

  <script>
    let openPrice = 0;
    let currentPrice = 0;

    async function fetchPrices() {
      try {
        const res = await fetch("https://api.coingecko.com/api/v3/coins/bitcoin");
        const data = await res.json();
        openPrice = data.market_data.current_price.usd / (1 + data.market_data.price_change_percentage_24h / 100);
        currentPrice = data.market_data.current_price.usd;
        document.getElementById("priceOpen").textContent = "Prix d'ouverture : " + openPrice.toFixed(2) + " USDT";
        document.getElementById("priceNow").textContent = "Prix actuel : " + currentPrice.toFixed(2) + " USDT";
      } catch (err) {
        document.getElementById("priceOpen").textContent = "Erreur API CoinGecko";
        document.getElementById("priceNow").textContent = "";
      }
    }

    function calculate() {
      const btcAmount = parseFloat(document.getElementById("btcInput").value);
      if (!btcAmount || currentPrice === 0 || openPrice === 0) return;

      const delta = currentPrice - openPrice;
      const W = btcAmount * currentPrice;
      const phi = 1.0;
      const psi = 1 - phi;
      const Y = delta * W * psi;

      document.getElementById("deltaNow").textContent = "Δ (écart réel) : " + delta.toFixed(2) + " USDT";
      document.getElementById("wNow").textContent = "Valeur du trade (W) : " + W.toFixed(2) + " USDT";
      document.getElementById("psiNow").textContent = "Ψ : " + psi.toFixed(4);
      document.getElementById("yResult").textContent = "Y (Δ·W·Ψ) : " + Y.toFixed(2) + " USDT";
    }

    setInterval(fetchPrices, 60000); // toutes les 60 sec
    setInterval(calculate, 500); // toutes les 0,5 sec
    fetchPrices();
  </script>
</body>
</html>
