
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BUHS • Y Calculator (BTC)</title>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; padding: 2rem; text-align: center; }
    h1 { font-size: 2rem; margin-bottom: 1rem; }
    input { padding: 0.5rem; font-size: 1rem; width: 200px; margin-top: 0.5rem; }
    .section { margin-top: 2rem; }
    #phi { font-size: 2rem; margin: 1rem; transition: color 0.3s; }
    .green { color: green; }
    .orange { color: orange; }
    .red { color: red; }
    #y-result, #delta, #y-usdc { font-size: 1.5rem; margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>BUHS • Calculateur de Y (BTC)</h1>

  <div class="section">
    <label>Valeur de ton trade ($ USDC) :</label><br/>
    <input type="number" id="tradeValue" placeholder="Ex: 10000"/><br/>

    <label>Volume engagé en BTC :</label><br/>
    <input type="number" id="tradeVolume" placeholder="Ex: 0.25"/>
  </div>

  <div id="delta">Δ = -- %</div>
  <div id="phi" class="green">Φ = --</div>
  <div id="y-result">Y = -- BTC</div>
  <div id="y-usdc">(≈ -- USDC)</div>

  <script>
    let cachedData = null;
    async function fetchBTCData() {
      try {
        const url = 'https://api.coingecko.com/api/v3/coins/bitcoin';
        const response = await fetch(url);
        const data = await response.json();
        const delta = data.market_data.price_change_percentage_24h / 100;
        const price = data.market_data.current_price.usd;
        const marketVolume = data.market_data.total_volume.usd;
        cachedData = { delta, price, marketVolume };
      } catch (e) {
        console.error("Erreur API:", e);
      }
    }

    function updateY() {
      const tradeValue = parseFloat(document.getElementById("tradeValue").value);
      const tradeVolume = parseFloat(document.getElementById("tradeVolume").value);
      const deltaElem = document.getElementById("delta");
      const phiElem = document.getElementById("phi");
      const yElem = document.getElementById("y-result");
      const yUSDC = document.getElementById("y-usdc");

      if (!cachedData || isNaN(tradeValue) || isNaN(tradeVolume) || tradeValue <= 0 || tradeVolume <= 0) {
        deltaElem.textContent = `Δ = -- %`;
        phiElem.textContent = `Φ = --`;
        yElem.textContent = `Y = -- BTC`;
        yUSDC.textContent = `(≈ -- USDC)`;
        return;
      }

      const { delta, price, marketVolume } = cachedData;

      const rhoTrade = tradeValue / tradeVolume;
      const rhoMarket = price / marketVolume;
      const phi = rhoTrade / rhoMarket;
      const psi = 1 - phi;
      const y = delta * tradeValue * psi;
      const yCrypto = y / price;

      deltaElem.textContent = `Δ = ${(delta * 100).toFixed(2)} %`;
      phiElem.textContent = `Φ = ${phi.toFixed(4)}`;
      phiElem.className = "";
      if (phi >= 0.95 && phi <= 1.05) {
        phiElem.classList.add("green");
      } else if (phi >= 0.85 && phi <= 1.15) {
        phiElem.classList.add("orange");
      } else {
        phiElem.classList.add("red");
      }

      yElem.textContent = `Y = ${yCrypto.toFixed(6)} BTC`;
      yUSDC.textContent = `(≈ ${y.toFixed(2)} USDC)`;
    }

    // Actualise les données du marché toutes les 60 secondes
    fetchBTCData();
    setInterval(fetchBTCData, 60000);

    // Rafraîchit les calculs toutes les 0.5 secondes
    setInterval(updateY, 500);
  </script>
</body>
</html>
